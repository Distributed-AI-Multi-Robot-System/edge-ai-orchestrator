stateDiagram-v2
    direction LR
    
    [*] --> Idle: Actor Ready
    
    state "Idle (Monitoring)" as Idle {
        [*] --> BufferAudio
        BufferAudio --> VADCheck: Process Chunk
        VADCheck --> BufferAudio: Silence
    }

    state "Recording Session" as Recording {
        state "Accumulating Audio" as Accumulating
        state "Offloading Background Task" as Offload
        
        [*] --> Accumulating
        
        Accumulating --> Accumulating: Continue Speech
        
        %% The core logic for background processing
        Accumulating --> Offload: Pause > 3s
        Offload --> Accumulating: Task Sent to 'Base' Model
    }

    state "Finalizing & Transcribing" as Finalizing {
        [*] --> CheckPending: Check Background Tasks
        CheckPending --> TranscribeTail: Send Remainder to 'Tail' Model
        TranscribeTail --> MergeResults: Gather All Text
        MergeResults --> [*]
    }

    %% Transitions
    Idle --> Recording: VAD 'Start' Detected
    Recording --> Finalizing: VAD 'End' Detected
    Finalizing --> Idle: Result Returned